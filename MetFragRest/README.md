## build/start app

```
mvn package
java -Dserver.port=8090 -jar target/MetFragRest-2.4.8.jar
```

## start app

mvn spring-boot:run

# Using Docker

It is also possible to build and use a Docker container for the MetFrag REST interface.

## Building
the container should be built from the `MetFragRelaunched` directory:
```
docker build -t sneumann/metfragrest -f Dockerfile-REST .
```

## Running
Then it is possible to launch the container with
```
docker run --rm -it -p 8090:8080 sneumann/metfragrest:latest
```

An example query would be:
```

curl -X POST -H "Content-Type: application/json" http://localhost:8090/metfrag/api/v1 -d \
    '{
        "fragmentpeakmatchabsolutemassdeviation": "0.001",
        "fragmentpeakmatchrelativemassdeviation": "5",
        "databasesearchrelativemassdeviation": "5",
        "metfragdatabasetype": "PubChem",
        "peakliststring":"177.092320760091_1451.08410644531;205.086236000061_1983.02587890625;229.086613972982_1455.84973144531;234.125782775879_9424.7314453125;243.102464294434_6834.91943359375;244.109477996826_1533.8046875;244.146520514237_4892.56103515625;257.117561340332_1164.64953613281;261.112461853027_3875.52514648438;262.119772774833_1165.22351074219;271.133573913574_13089.0126953125;272.139910529642_2833.46997070312;274.120386297053_1286.1396484375;275.12854309082_28140.5546875;276.132524490356_2414.30102539062;285.14973449707_1103.77197265625;287.128471374512_2708.40209960938;287.164703369141_1599.52160644531;299.165280151367_1428.58227539062;300.136039733887_1403.30676269531;311.165107727051_1970.57592773438;313.149806213379_9827.076171875;313.180361938477_197179.75;314.152227228338_1240.31591796875;314.183631896973_14364.0771484375;315.159642028809_287124;316.163235473633_21380.60546875;325.180702209473_1367.2001953125;327.196063995361_1536.09033203125;329.175514622738_2210.23046875;330.182575426604_2943.61254882812;339.197692871094_1151.18811035156;340.241302490234_1050.67346191406;341.175484793527_1900.67651367188;343.190165201823_1245.60681152344;353.210777282715_1409.009765625;353.248142496745_3203.60986328125;354.25524597168_5494.884765625;355.191353352865_1707.62768554688;355.263327026367_6431.8408203125;367.263783772786_1120.03723144531;368.272043863932_1573.63305664062;369.206732177734_12602.3115234375;370.211002349854_1442.79187011719;371.222595214844_2184.82690429688;381.205629047595_6095.37890625;381.243681335449_13951.033203125;382.248254949396_1968.34484863281;383.222082519531_340943.9375;384.228602600098_73401.9609375;385.234485202365_3912.12866210938;395.223587036133_1795.80224609375;395.258506774902_73514.359375;396.263960266113_10231.8681640625;397.23766784668_204010.359375;398.242947387695_23262.927734375;399.249359130859_1100.38000488281;409.23782602946_2197.42846679688;410.245188395182_3128.14868164062;411.253760086863_8162.02685546875;422.31834763747_1995.22106933594;423.252960205078_24539.48046875;423.297088623047_1005.40423583984;424.257669448853_3149.98852539062;438.313815030185_1848.50830078125;451.284339904785_40680.7421875;452.28828671104_3518.17065429688;464.32948811849_1396.36779785156;465.29237874349_6912.3564453125;465.34294128418_2235.52661132812;466.307887268066_1091252.5;467.311297607422_100971.46875;491.388732910156_4496.3466796875;492.324691772461_5253.52587890625", "neutralprecursormolecularformula": "C10H11N4O5", "precursoriontype": "[M-H]-", "neutralprecursormass": "267.07291"
    }'
```

The return value include the processID, which is used to query the status:
```
curl http://localhost:8090/metfrag/api/v1/status/java_io_tmpdir5547995162586347505
```
and obtain the results:
```
curl http://localhost:8090/metfrag/api/v1/result/java_io_tmpdir5547995162586347505
```

## Configuration

The REST API base URL can be configured. There is the file `src/main/ressources/application.properties` containing the default URL http://localhost:8090/metfrag/api/v1

You can override the `metfragrest-controller.path` property by providing your own `application.properties` at runtime in the current working directory `./` or a `./config/` subdirectory, see [docs](https://docs.spring.io/spring-boot/docs/2.1.13.RELEASE/reference/html/boot-features-external-config.html#boot-features-external-config-application-property-files).

Finally, it is possible to override both defaults and the custom `applications.properties` on the command line at runtime. First using a system property: `java -Dmetfragrest-controller.path=/mybaseurl/api/v1 -Dserver.port=8090 -jar target/MetFragRest-2.5.0.jar`, which in turn can be overriden by an application property: `java -Dserver.port=8090 -jar target/MetFragRest-2.5.0.jar --metfragrest-controller.path=/commandline/api/v1` which in turn can be overridden by an environment variable: `METFRAGREST_CONTROLLER_PATH=/overridemybaseurl mvn spring-boot:run`.
